<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ML Crop Yield Predictor</title>
    <!-- Load Tailwind CSS from CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
    </style>
</head>

<body class="min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-lg bg-white p-8 rounded-xl shadow-2xl border border-gray-100">
        <h1 class="text-3xl font-bold text-gray-800 mb-6 border-b pb-2">
            Crop Yield Forecast
        </h1>
        <p class="text-sm text-gray-600 mb-6">
            Input the conditions to predict the yield (tons/ha) using your deployed XGBoost model.
        </p>

        <form id="predictionForm" class="space-y-4">
            <!-- Row 1: Region & Crop -->
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label for="Region" class="block text-sm font-medium text-gray-700">Region</label>
                    <select id="Region"
                        class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md shadow-sm">
                        <option value="North">North</option>
                        <option value="East">East</option>
                        <option value="South">South</option>
                        <option value="West">West</option>
                    </select>
                </div>
                <div>
                    <label for="Crop" class="block text-sm font-medium text-gray-700">Crop Type</label>
                    <select id="Crop"
                        class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md shadow-sm">
                        <option value="Maize">Maize</option>
                        <option value="Wheat">Wheat</option>
                        <option value="Rice">Rice</option>
                        <option value="Barley">Barley</option>
                        <option value="Soybean">Soybean</option>
                        <option value="Cotton">Cotton</option>
                    </select>
                </div>
            </div>

            <!-- Row 2: Soil & Weather -->
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label for="Soil_Type" class="block text-sm font-medium text-gray-700">Soil Type</label>
                    <select id="Soil_Type"
                        class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md shadow-sm">
                        <option value="Loam">Loam</option>
                        <option value="Clay">Clay</option>
                        <option value="Sandy">Sandy</option>
                        <option value="Silt">Silt</option>
                    </select>
                </div>
                <div>
                    <label for="Weather_Condition" class="block text-sm font-medium text-gray-700">Weather
                        Condition</label>
                    <select id="Weather_Condition"
                        class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md shadow-sm">
                        <option value="Sunny">Sunny</option>
                        <option value="Cloudy">Cloudy</option>
                        <option value="Rainy">Rainy</option>
                    </select>
                </div>
            </div>

            <!-- Row 3: Rainfall & Temperature -->
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label for="Rainfall_mm" class="block text-sm font-medium text-gray-700">Rainfall (mm)</label>
                    <input type="number" id="Rainfall_mm" value="500" step="0.1"
                        class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2">
                </div>
                <div>
                    <label for="Temperature_Celsius" class="block text-sm font-medium text-gray-700">Temperature
                        (Â°C)</label>
                    <input type="number" id="Temperature_Celsius" value="25" step="0.1"
                        class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2">
                </div>
            </div>

            <!-- Row 4: Days to Harvest -->
            <div>
                <label for="Days_to_Harvest" class="block text-sm font-medium text-gray-700">Days to Harvest (e.g.,
                    90-180)</label>
                <input type="number" id="Days_to_Harvest" value="130" step="1" min="1"
                    class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md p-2">
            </div>

            <!-- Row 5: Fertilizer & Irrigation -->
            <div class="flex items-center space-x-6 pt-2">
                <div class="flex items-center">
                    <input id="Fertilizer_Used" name="Fertilizer_Used" type="checkbox" checked
                        class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                    <label for="Fertilizer_Used" class="ml-2 block text-sm text-gray-900">
                        Fertilizer Used
                    </label>
                </div>
                <div class="flex items-center">
                    <input id="Irrigation_Used" name="Irrigation_Used" type="checkbox" checked
                        class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                    <label for="Irrigation_Used" class="ml-2 block text-sm text-gray-900">
                        Irrigation Used
                    </label>
                </div>
            </div>

            <!-- Submit Button -->
            <button type="submit" id="predictButton"
                class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
                Predict Yield
            </button>
        </form>

        <!-- Result Display Area -->
        <div id="resultContainer" class="mt-6 p-4 border border-gray-200 rounded-lg text-center hidden">
            <h2 class="text-xl font-semibold text-gray-800">Predicted Yield:</h2>
            <p id="predictionResult" class="text-4xl font-extrabold text-indigo-600 mt-2"></p>
            <p class="text-sm text-gray-500">tons per hectare</p>
        </div>

        <div id="messageBox" class="mt-4 text-sm text-center p-3 rounded-md hidden"></div>

    </div>

    <script>
        document.getElementById('predictionForm').addEventListener('submit', async function (event) {
            event.preventDefault();

            const form = event.target;
            const predictButton = document.getElementById('predictButton');
            const resultContainer = document.getElementById('resultContainer');
            const predictionResult = document.getElementById('predictionResult');
            const messageBox = document.getElementById('messageBox');

            // Disable button and show loading state
            predictButton.disabled = true;
            predictButton.textContent = 'Predicting...';
            messageBox.classList.add('hidden');
            resultContainer.classList.add('hidden');

            try {
                // 1. Gather all input values
                const inputData = {
                    Region: form.elements.Region.value,
                    Soil_Type: form.elements.Soil_Type.value,
                    Crop: form.elements.Crop.value,
                    Rainfall_mm: parseFloat(form.elements.Rainfall_mm.value),
                    Temperature_Celsius: parseFloat(form.elements.Temperature_Celsius.value),
                    Fertilizer_Used: form.elements.Fertilizer_Used.checked,
                    Irrigation_Used: form.elements.Irrigation_Used.checked,
                    Days_to_Harvest: parseInt(form.elements.Days_to_Harvest.value),
                    Weather_Condition: form.elements.Weather_Condition.value,
                };

                // 2. Send POST request to the deployed Flask service
                const response = await fetch('http://localhost:5000/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(inputData)
                });

                const result = await response.json();

                // 3. Handle response (success or failure)
                if (response.ok && result.status === 'success') {
                    const yieldValue = result.predicted_yield_tons_per_hectare;

                    predictionResult.textContent = yieldValue.toFixed(2);
                    resultContainer.classList.remove('hidden');

                    messageBox.textContent = `Prediction successful!`;
                    messageBox.classList.remove('bg-red-100', 'text-red-700');
                    messageBox.classList.add('bg-green-100', 'text-green-700');

                } else {
                    const errorMessage = result.error || "Unknown server error.";

                    messageBox.textContent = `Prediction Failed: ${errorMessage}`;
                    messageBox.classList.remove('bg-green-100', 'text-green-700');
                    messageBox.classList.add('bg-red-100', 'text-red-700');
                }

                messageBox.classList.remove('hidden');

            } catch (error) {
                console.error("Fetch Error:", error);

                messageBox.textContent = `Network Error: Could not reach the service at http://localhost:5000. Ensure Docker is running.`;
                messageBox.classList.remove('bg-green-100', 'text-green-700');
                messageBox.classList.add('bg-red-100', 'text-red-700');
                messageBox.classList.remove('hidden');

            } finally {
                // Re-enable button
                predictButton.disabled = false;
                predictButton.textContent = 'Predict Yield';
            }
        });
    </script>
</body>

</html>